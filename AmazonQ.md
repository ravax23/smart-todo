# GitHub 取り扱いルールブック

**注意: このファイルは指示があるまで編集不可です**

## 1. ブランチ管理

### 1.0 ブランチ作成・マージの基本ルール
- **重要**: Issueに取り掛かる、またはブランチ作成の明示的な指示がない限り、ブランチを作成しない
- **重要**: mainブランチへのマージは必ず明示的な指示を受けてから行う
- **重要**: リモートリポジトリへのプッシュは明示的な指示がない限り行わない（基本はローカルリポジトリのみ）
- 上記ルールに違反した場合、作業内容が破棄される可能性がある

### 1.1 ブランチの命名規則
- `main`: 本番環境用のメインブランチ
- `feature/issue#<番号>_<タイトル>`: 新機能開発用のブランチ（例: `feature/issue#123_login-page`）
- `bugfix/issue#<番号>_<タイトル>`: バグ修正用のブランチ（例: `bugfix/issue#456_login-error`）
- `hotfix/issue#<番号>_<タイトル>`: 緊急の修正用のブランチ（例: `hotfix/issue#789_security-issue`）
- `release/*`: リリース準備用のブランチ（例: `release/v1.0.0`）

### 1.2 ブランチの作成
```bash
git checkout -b <ブランチタイプ>/issue#<番号>_<タイトル> main
```

例:
```bash
# Issue #123 の新機能開発用ブランチを作成
git checkout -b feature/issue#123_login-page main

# Issue #456 のバグ修正用ブランチを作成
git checkout -b bugfix/issue#456_login-error main
```

### 1.3 ブランチのアーカイブ
ブランチをアーカイブする場合は、以下の手順に従います：
1. ブランチの情報（コミットハッシュ、メッセージなど）をアーカイブファイルに保存
2. ブランチ名の先頭に `archived/` を付けてリネーム
3. ブランチ自体は削除しない

```bash
# ブランチ情報の保存
mkdir -p archive_branches
git show --no-patch --format="%H %s" <ブランチ名> > archive_branches/<ブランチ名>.txt

# ブランチのリネーム
git branch -m <ブランチ名> archived/<ブランチ名>
```

### 1.4 ブランチの削除
ブランチを削除する場合は、必ずチームの承認を得た上で行います：
```bash
# ローカルブランチの削除
git branch -d <ブランチ名>  # 安全な削除（マージ済みの場合のみ削除）
git branch -D <ブランチ名>  # 強制削除（マージ状態に関わらず削除）

# リモートブランチの削除
git push origin --delete <ブランチ名>
```

## 2. コミット管理

### 2.1 コミットメッセージの形式
```
[タイプ]: [説明]

[詳細な説明（オプション）]
```

タイプ:
- `Feature`: 新機能
- `Fix`: バグ修正
- `Docs`: ドキュメントのみの変更
- `Style`: コードの意味に影響しない変更（フォーマットなど）
- `Refactor`: バグ修正や機能追加ではないコード変更
- `Test`: テストの追加・修正
- `Chore`: ビルドプロセスやツールの変更

### 2.2 良いコミットの例
```
Feature: ユーザー認証機能の追加

- Google OAuthによるログイン機能を実装
- ユーザープロフィール画面の追加
- セッション管理の実装
```

### 2.3 コミットの頻度
- 論理的に完結した変更ごとにコミットする
- 1つのコミットに複数の機能変更を含めない
- 作業中のコードは定期的にコミットする（少なくとも1日1回）

## 3. プルリクエスト

### 3.1 プルリクエストの作成
- 機能やバグ修正が完了したら、`main`ブランチに対してプルリクエストを作成
- プルリクエストのタイトルはコミットメッセージの形式に従う
- 詳細な説明、スクリーンショット、関連するIssue番号を含める

### 3.2 プルリクエストのレビュー
- 少なくとも1人のレビュアーの承認が必要
- CI/CDテストがすべて通過していることを確認
- コードスタイル、パフォーマンス、セキュリティの観点からレビュー

### 3.3 プルリクエストのマージ
- レビュー承認後、`main`ブランチにマージ
- マージ後、関連するIssueをクローズ
- マージ後、作業ブランチを適切に処理（アーカイブまたは削除）

### 3.4 mainブランチへの反映
- mainブランチへ変更を反映させる際は、必ずGitHubにも反映する（`git push origin main`）
- 変更を反映後、作業元のブランチはアーカイブする（1.3のブランチのアーカイブ手順に従う）
- 対応していたIssueは完了（Close）にする
- **重要**: mainブランチへの反映は指示があるまで行わない

## 4. Issue管理

### 4.1 Issueの作成
- 新機能、バグ、改善提案はすべてIssueとして記録
- 明確なタイトルと詳細な説明を含める
- 適切なラベル（`bug`, `enhancement`, `documentation`など）を付ける
- 可能であれば再現手順、スクリーンショット、エラーログを含める

### 4.2 Issueのテンプレート
```markdown
### 概要
[問題や機能の簡潔な説明]

### 現状
[現在の状態や問題点]

### 期待される動作
[どのように動作すべきか]

### 再現手順
1. [手順1]
2. [手順2]
3. [手順3]

### スクリーンショット
[関連するスクリーンショットがあれば]

### 環境
- OS: [例: Windows 10]
- ブラウザ: [例: Chrome 90.0]
- バージョン: [例: v1.2.3]

### 追加情報
[その他の関連情報]
```

### 4.3 Issueのクローズ
- 関連するプルリクエストがマージされたら自動的にクローズ
- 手動でクローズする場合は、理由を明記

## 5. リリース管理

### 5.1 バージョニング
セマンティックバージョニング（SemVer）を使用：
- メジャーバージョン（X.0.0）: 後方互換性のない変更
- マイナーバージョン（0.X.0）: 後方互換性のある機能追加
- パッチバージョン（0.0.X）: バグ修正

### 5.2 リリースプロセス
1. `release/vX.Y.Z`ブランチを作成
2. リリースノートの作成
3. 最終テストの実施
4. `main`ブランチにマージ
5. タグ付け: `git tag -a vX.Y.Z -m "バージョンX.Y.Z"`
6. タグをプッシュ: `git push origin vX.Y.Z`

### 5.3 リリースノート
- 追加された機能
- 修正されたバグ
- 非推奨になった機能
- 削除された機能
- 既知の問題

## 6. セキュリティ

### 6.1 機密情報
以下の情報はGitHubにコミットしないこと：
- APIキー、シークレットキー
- パスワード、認証情報
- 個人を特定できる情報（PII）
- 内部IPアドレス、サーバー構成
- 環境変数ファイル（.env）

### 6.2 機密情報の管理
- `.gitignore`ファイルに機密ファイルを追加
- 環境変数を使用（`.env.example`ファイルをテンプレートとして提供）
- 必要に応じてGitHub Secretsを使用

## 7. GitHub Actions

### 7.1 CI/CDパイプライン
- プルリクエスト時に自動テスト実行
- `main`ブランチへのマージ時に自動デプロイ
- コードの静的解析とリンティング

### 7.2 ワークフローファイル
- `.github/workflows/`ディレクトリに配置
- YAMLフォーマットで記述
- 再利用可能なアクションを活用

## 8. ドキュメント

### 8.1 必須ドキュメント
- `README.md`: プロジェクト概要、セットアップ手順
- `CONTRIBUTING.md`: 貢献ガイドライン
- `LICENSE`: ライセンス情報
- `CHANGELOG.md`: 変更履歴

### 8.2 コードドキュメント
- 関数、クラス、メソッドには適切なコメントを付ける
- 複雑なロジックには説明コメントを追加
- APIドキュメントを自動生成できるようにコメントを書く

## 9. トラブルシューティング

### 9.1 一般的な問題
- コンフリクトの解決
- 誤ったコミットの修正
- リモートブランチの同期

### 9.2 コンフリクト解決
```bash
git fetch origin
git merge origin/main
# コンフリクトを解決
git add .
git commit -m "Fix: コンフリクトの解決"
```

### 9.3 誤ったコミットの修正
```bash
# 直前のコミットを修正
git commit --amend -m "新しいコミットメッセージ"

# 複数のコミットを修正（インタラクティブリベース）
git rebase -i HEAD~3  # 直近3つのコミットを編集
```

## 10. 最終規則

- このルールブックに記載されていない状況が発生した場合は、チームに相談する
- ルールの変更は、チームの合意を得た上で行う
- 常に最新のベストプラクティスを取り入れる
